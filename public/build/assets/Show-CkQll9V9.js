import{r as N,j as e,u as I,H as S,L as k,b as v}from"./app-1W8TeX0H.js";import{A as E}from"./AuthenticatedLayout-CcOQv49i.js";import{I as _}from"./InputLabel-DuWin7lX.js";import{I as R}from"./TextInput-Bz44hQBx.js";import{M as C}from"./MoneyInput-oYiqKE3_.js";import{P as T}from"./PrimaryButton-5zQZpWJx.js";import"./transition-BXzt8kZb.js";function L({bandMembers:i,totalAmount:d,existingDistributions:h=[],onSubmit:b,processing:p=!1,errors:m={}}){const f=()=>{if(h.length>0)return h.map(s=>({recipient_type:s.recipient_type,recipient_user_id:s.recipient_user_id,amount:s.amount.toString(),note:s.note||""}));const t=i.map(s=>({recipient_type:"user",recipient_user_id:s.id,amount:"",note:""}));return t.push({recipient_type:"mutual_fund",recipient_user_id:void 0,amount:"",note:""}),t},[n,u]=N.useState(f()),[o,g]=N.useState(!1),x=(t,s,r)=>{const a=[...n];a[t]={...a[t],[s]:r},u(a)},l=()=>n.reduce((t,s)=>t+(parseFloat(s.amount)||0),0),w=()=>d-l(),D=()=>{const t=[...n],s=o?t:t.filter(a=>a.recipient_type!=="mutual_fund"),r=(d/s.length).toFixed(2);t.forEach(a=>{o||a.recipient_type!=="mutual_fund"?a.amount=r:a.amount="0"}),u(t)},F=t=>{t.preventDefault();const s=n.filter(r=>parseFloat(r.amount)>0);b(s)},y=w(),j=y<0;return e.jsxs("form",{onSubmit:F,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Income Distribution"}),e.jsxs("p",{className:"mt-1 text-sm text-gray-600",children:["Total to distribute: ",e.jsxs("span",{className:"font-semibold",children:[d.toFixed(2)," EUR"]})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:o,onChange:t=>g(t.target.checked),className:"h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"}),e.jsx("span",{className:"text-gray-700",children:"Include Mutual Fund"})]}),e.jsx("button",{type:"button",onClick:D,className:"rounded-md bg-gray-200 px-3 py-2 text-sm font-semibold text-gray-700 hover:bg-gray-300",children:"Distribute Equally"})]})]}),e.jsx("div",{className:"space-y-4",children:n.map((t,s)=>{const r=t.recipient_type==="user"?i.find(c=>c.id===t.recipient_user_id):null,a=t.recipient_type==="mutual_fund"?"Mutual Fund":r?.name||"Unknown";return e.jsxs("div",{className:"rounded-lg border border-gray-200 p-4",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx(_,{value:"Recipient"}),e.jsxs("div",{className:"mt-1 flex items-center",children:[e.jsx("span",{className:"font-medium text-gray-900",children:a}),t.recipient_type==="mutual_fund"&&e.jsx("span",{className:"ml-2 rounded-full bg-blue-100 px-2 py-0.5 text-xs text-blue-800",children:"Band Fund"})]})]}),e.jsx(C,{label:"Amount",value:t.amount,onChange:c=>x(s,"amount",c),error:m[`distributions.${s}.amount`]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx(_,{htmlFor:`note-${s}`,value:"Note (optional)"}),e.jsx("input",{id:`note-${s}`,type:"text",value:t.note,onChange:c=>x(s,"note",c.target.value),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm",placeholder:"Optional note..."})]})]},s)})}),e.jsxs("div",{className:"mt-6 rounded-lg bg-gray-50 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Total Distributed:"}),e.jsxs("span",{className:"font-semibold text-gray-900",children:[l().toFixed(2)," EUR"]})]}),e.jsxs("div",{className:`mt-2 flex items-center justify-between text-sm ${j?"text-red-600":"text-gray-600"}`,children:[e.jsx("span",{children:"Remaining:"}),e.jsxs("span",{className:"font-semibold",children:[y.toFixed(2)," EUR"]})]}),j&&e.jsx("p",{className:"mt-2 text-sm text-red-600",children:"⚠️ Total distributed exceeds income amount!"})]}),m.distributions&&e.jsx(R,{message:m.distributions,className:"mt-2"})]}),e.jsx("div",{className:"flex items-center justify-end",children:e.jsx(T,{disabled:p||j,children:p?"Saving...":"Save Distribution"})})]})}function H({income:i,bandMembers:d,totalDistributed:h,remaining:b}){const{data:p,setData:m,post:f,processing:n,errors:u}=I({distributions:[]}),o=l=>new Date(l).toLocaleDateString("sl-SI",{year:"numeric",month:"long",day:"numeric"}),g=l=>{v.post(route("incomes.distribute",i.id),{distributions:l})},x=()=>{confirm("Are you sure you want to delete this income? All distributions will also be deleted.")&&v.delete(route("incomes.destroy",i.id))};return e.jsxs(E,{header:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-semibold leading-tight text-gray-800",children:"Income Details"}),e.jsx(k,{href:route("incomes.index"),className:"text-sm text-gray-600 hover:text-gray-900",children:"← Back to List"})]}),children:[e.jsx(S,{title:`Income - ${i.contact_person}`}),e.jsx("div",{className:"py-12",children:e.jsxs("div",{className:"mx-auto max-w-4xl sm:px-6 lg:px-8",children:[e.jsx("div",{className:"mb-6 overflow-hidden rounded-lg bg-white shadow-sm",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold text-gray-900",children:i.contact_person}),e.jsxs("p",{className:"mt-1 text-lg font-semibold text-green-600",children:[parseFloat(i.amount.toString()).toFixed(2)," ",i.currency]}),i.inquiry&&e.jsxs("p",{className:"mt-1 text-sm text-gray-600",children:["From: ",i.inquiry.location_name]})]}),e.jsx("div",{className:"flex gap-2",children:i.invoice_issued&&e.jsx("span",{className:"inline-flex rounded-full bg-blue-100 px-3 py-1 text-xs font-semibold text-blue-800",children:"Invoice Issued"})})]}),e.jsx("div",{className:"mt-6",children:e.jsx("button",{onClick:x,className:"rounded-md bg-red-600 px-4 py-2 text-sm font-semibold text-white shadow-sm hover:bg-red-500",children:"Delete"})})]})}),e.jsxs("div",{className:"mb-6 overflow-hidden rounded-lg bg-white shadow-sm",children:[e.jsx("div",{className:"border-b border-gray-200 px-6 py-4",children:e.jsx("h4",{className:"text-lg font-medium text-gray-900",children:"Income Details"})}),e.jsxs("div",{className:"p-6",children:[e.jsxs("dl",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500",children:"Date"}),e.jsx("dd",{className:"mt-1 text-sm text-gray-900",children:o(i.income_date)})]}),e.jsxs("div",{children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500",children:"Performance Type"}),e.jsx("dd",{className:"mt-1 text-sm text-gray-900",children:i.performance_type.name})]}),e.jsxs("div",{children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500",children:"Created By"}),e.jsx("dd",{className:"mt-1 text-sm text-gray-900",children:i.creator.name})]})]}),i.notes&&e.jsxs("div",{className:"mt-4",children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500",children:"Notes"}),e.jsx("dd",{className:"mt-1 whitespace-pre-wrap text-sm text-gray-900",children:i.notes})]})]})]}),e.jsxs("div",{className:"overflow-hidden rounded-lg bg-white shadow-sm",children:[e.jsx("div",{className:"border-b border-gray-200 px-6 py-4",children:e.jsx("h4",{className:"text-lg font-medium text-gray-900",children:"Distribution"})}),e.jsx("div",{className:"p-6",children:e.jsx(L,{bandMembers:d,totalAmount:parseFloat(i.amount.toString()),existingDistributions:i.distributions,onSubmit:g,processing:n,errors:u})})]})]})})]})}export{H as default};
