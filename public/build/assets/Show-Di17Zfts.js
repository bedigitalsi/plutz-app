import{r as v,j as e,u as F,H as I,a as y}from"./app-HlzfsMCi.js";import{A as S}from"./AuthenticatedLayout-BFCyOzdz.js";import{I as z}from"./InputLabel-CNFOQqQl.js";import{I as k}from"./TextInput-DV0Zl7lm.js";import{M as E}from"./MoneyInput-DF_xse-4.js";import{P as R}from"./PrimaryButton-StSgpESa.js";import"./transition-JSdg_jrA.js";function C({bandMembers:n,totalAmount:d,existingDistributions:p=[],onSubmit:f,processing:h=!1,errors:u={}}){const N=()=>{if(p.length>0)return p.map(s=>({recipient_type:s.recipient_type,recipient_user_id:s.recipient_user_id,amount:s.amount.toString(),note:s.note||""}));const t=n.map(s=>({recipient_type:"user",recipient_user_id:s.id,amount:"",note:""}));return t.push({recipient_type:"mutual_fund",recipient_user_id:void 0,amount:"",note:""}),t},[a,m]=v.useState(N()),[o,b]=v.useState(!1),x=(t,s,r)=>{const i=[...a];i[t]={...i[t],[s]:r},m(i)},l=()=>a.reduce((t,s)=>t+(parseFloat(s.amount)||0),0),_=()=>d-l(),w=()=>{const t=[...a],s=o?t:t.filter(i=>i.recipient_type!=="mutual_fund"),r=(d/s.length).toFixed(2);t.forEach(i=>{o||i.recipient_type!=="mutual_fund"?i.amount=r:i.amount="0"}),m(t)},D=t=>{t.preventDefault();const s=a.filter(r=>parseFloat(r.amount)>0);f(s)},g=_(),j=g<0;return e.jsxs("form",{onSubmit:D,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-plutz-cream",children:"Income Distribution"}),e.jsxs("p",{className:"mt-1 text-sm text-stone-400",children:["Total to distribute: ",e.jsxs("span",{className:"font-semibold text-plutz-cream",children:[d.toFixed(2)," EUR"]})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:o,onChange:t=>b(t.target.checked),className:"h-4 w-4 rounded border-plutz-tan/20 bg-plutz-dark text-plutz-tan focus:ring-plutz-tan"}),e.jsx("span",{className:"text-stone-400",children:"Include Mutual Fund"})]}),e.jsx("button",{type:"button",onClick:w,className:"rounded-xl bg-plutz-tan/20 px-3 py-2 text-sm font-semibold text-plutz-tan hover:bg-plutz-tan/30 border border-plutz-tan/20 transition",children:"Distribute Equally"})]})]}),e.jsx("div",{className:"space-y-4",children:a.map((t,s)=>{const r=t.recipient_type==="user"?n.find(c=>c.id===t.recipient_user_id):null,i=t.recipient_type==="mutual_fund"?"Mutual Fund":r?.name||"Unknown";return e.jsxs("div",{className:"rounded-xl border border-plutz-tan/10 bg-plutz-dark p-4",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx(z,{value:"Recipient"}),e.jsxs("div",{className:"mt-1 flex items-center",children:[e.jsx("span",{className:"font-medium text-plutz-cream",children:i}),t.recipient_type==="mutual_fund"&&e.jsx("span",{className:"ml-2 rounded-full bg-plutz-tan/20 px-2 py-0.5 text-xs text-plutz-tan",children:"Band Fund"})]})]}),e.jsx(E,{label:"Amount",value:t.amount,onChange:c=>x(s,"amount",c),error:u[`distributions.${s}.amount`]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx(z,{htmlFor:`note-${s}`,value:"Note (optional)"}),e.jsx("input",{id:`note-${s}`,type:"text",value:t.note,onChange:c=>x(s,"note",c.target.value),className:"mt-1 block w-full rounded-lg border-plutz-tan/20 bg-plutz-dark text-plutz-cream shadow-sm focus:border-plutz-tan focus:ring-plutz-tan sm:text-sm",placeholder:"Optional note..."})]})]},s)})}),e.jsxs("div",{className:"mt-6 rounded-xl bg-stone-900/50 border border-plutz-tan/10 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-stone-400",children:"Total Distributed:"}),e.jsxs("span",{className:"font-semibold text-plutz-cream",children:[l().toFixed(2)," EUR"]})]}),e.jsxs("div",{className:`mt-2 flex items-center justify-between text-sm ${j?"text-red-400":"text-stone-400"}`,children:[e.jsx("span",{children:"Remaining:"}),e.jsxs("span",{className:"font-semibold",children:[g.toFixed(2)," EUR"]})]}),j&&e.jsx("p",{className:"mt-2 text-sm text-red-400",children:"Total distributed exceeds income amount!"})]}),u.distributions&&e.jsx(k,{message:u.distributions,className:"mt-2"})]}),e.jsx("div",{className:"flex items-center justify-end",children:e.jsx(R,{disabled:h||j,children:h?"Saving...":"Save Distribution"})})]})}function P({income:n,bandMembers:d,totalDistributed:p,remaining:f}){const{data:h,setData:u,post:N,processing:a,errors:m}=F({distributions:[]}),o=l=>new Date(l).toLocaleDateString("sl-SI",{year:"numeric",month:"long",day:"numeric"}),b=l=>{y.post(route("incomes.distribute",n.id),{distributions:l})},x=()=>{confirm("Are you sure you want to delete this income? All distributions will also be deleted.")&&y.delete(route("incomes.destroy",n.id))};return e.jsxs(S,{className:"bg-plutz-dark",children:[e.jsx(I,{title:`Income - ${n.contact_person}`}),e.jsxs("div",{className:"max-w-[1200px] mx-auto w-full p-6",children:[e.jsx("div",{className:"mb-6 overflow-hidden rounded-lg bg-plutz-surface shadow-sm",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold text-plutz-cream",children:n.contact_person}),e.jsxs("p",{className:"mt-1 text-lg font-semibold text-green-400",children:[parseFloat(n.amount.toString()).toFixed(2)," ",n.currency]}),n.inquiry&&e.jsxs("p",{className:"mt-1 text-sm text-stone-400",children:["From: ",n.inquiry.location_name]})]}),e.jsx("div",{className:"flex gap-2",children:n.invoice_issued&&e.jsx("span",{className:"inline-flex rounded-full bg-plutz-tan/20 px-3 py-1 text-xs font-semibold text-plutz-tan",children:"Invoice Issued"})})]}),e.jsx("div",{className:"mt-6",children:e.jsx("button",{onClick:x,className:"rounded-md bg-red-600 px-4 py-2 text-sm font-semibold text-white shadow-sm hover:bg-red-500/100",children:"Delete"})})]})}),e.jsxs("div",{className:"mb-6 overflow-hidden rounded-lg bg-plutz-surface shadow-sm",children:[e.jsx("div",{className:"border-b border-plutz-tan/10 px-6 py-4",children:e.jsx("h4",{className:"text-lg font-medium text-plutz-cream",children:"Income Details"})}),e.jsxs("div",{className:"p-6",children:[e.jsxs("dl",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("dt",{className:"text-sm font-medium text-stone-500",children:"Date"}),e.jsx("dd",{className:"mt-1 text-sm text-plutz-cream",children:o(n.income_date)})]}),e.jsxs("div",{children:[e.jsx("dt",{className:"text-sm font-medium text-stone-500",children:"Performance Type"}),e.jsx("dd",{className:"mt-1 text-sm text-plutz-cream",children:n.performance_type.name})]}),e.jsxs("div",{children:[e.jsx("dt",{className:"text-sm font-medium text-stone-500",children:"Created By"}),e.jsx("dd",{className:"mt-1 text-sm text-plutz-cream",children:n.creator.name})]})]}),n.notes&&e.jsxs("div",{className:"mt-4",children:[e.jsx("dt",{className:"text-sm font-medium text-stone-500",children:"Notes"}),e.jsx("dd",{className:"mt-1 whitespace-pre-wrap text-sm text-plutz-cream",children:n.notes})]})]})]}),e.jsxs("div",{className:"overflow-hidden rounded-lg bg-plutz-surface shadow-sm",children:[e.jsx("div",{className:"border-b border-plutz-tan/10 px-6 py-4",children:e.jsx("h4",{className:"text-lg font-medium text-plutz-cream",children:"Distribution"})}),e.jsx("div",{className:"p-6",children:e.jsx(C,{bandMembers:d,totalAmount:parseFloat(n.amount.toString()),existingDistributions:n.distributions,onSubmit:b,processing:a,errors:m})})]})]})]})}export{P as default};
