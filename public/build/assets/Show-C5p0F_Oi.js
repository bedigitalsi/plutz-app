import{r as _,j as t,u as S,H as E,b as y}from"./app-JcB2uSP0.js";import{A as I}from"./AuthenticatedLayout-DZ9_gY1e.js";import{I as z}from"./InputLabel-NOzwdOk-.js";import{I as C}from"./TextInput-clwo88ba.js";import{M as R}from"./MoneyInput-D7l21Cvn.js";import{P as U}from"./PrimaryButton-CDBnY_H_.js";import{u as w}from"./useTranslation-iEWy5_hl.js";import"./transition-Bs3KjsuR.js";function $({bandMembers:i,totalAmount:c,existingDistributions:b=[],onSubmit:N,processing:r=!1,errors:x={}}){const{t:n}=w(),g=()=>{if(b.length>0)return b.map(s=>({recipient_type:s.recipient_type,recipient_user_id:s.recipient_user_id,amount:s.amount.toString(),note:s.note||""}));const e=i.map(s=>({recipient_type:"user",recipient_user_id:s.id,amount:"",note:""}));return e.push({recipient_type:"mutual_fund",recipient_user_id:void 0,amount:"",note:""}),e},[l,p]=_.useState(g()),[u,f]=_.useState(!1),h=(e,s,d)=>{const a=[...l];a[e]={...a[e],[s]:d},p(a)},o=()=>l.reduce((e,s)=>e+(parseFloat(s.amount)||0),0),D=()=>c-o(),F=()=>{const e=[...l],s=u?e:e.filter(a=>a.recipient_type!=="mutual_fund"),d=(c/s.length).toFixed(2);e.forEach(a=>{u||a.recipient_type!=="mutual_fund"?a.amount=d:a.amount="0"}),p(e)},k=e=>{e.preventDefault();const s=l.filter(d=>parseFloat(d.amount)>0);N(s)},v=D(),j=v<0;return t.jsxs("form",{onSubmit:k,className:"space-y-6",children:[t.jsxs("div",{children:[t.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h3",{className:"text-lg font-medium text-plutz-cream",children:n("distribution.title")}),t.jsxs("p",{className:"mt-1 text-sm text-stone-400",children:[n("distribution.total_to_distribute")," ",t.jsxs("span",{className:"font-semibold text-plutz-cream",children:[c.toFixed(2)," EUR"]})]})]}),t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[t.jsx("input",{type:"checkbox",checked:u,onChange:e=>f(e.target.checked),className:"h-4 w-4 rounded border-plutz-tan/20 bg-plutz-dark text-plutz-tan focus:ring-plutz-tan"}),t.jsx("span",{className:"text-stone-400",children:n("distribution.include_mutual_fund")})]}),t.jsx("button",{type:"button",onClick:F,className:"rounded-xl bg-plutz-tan/20 px-3 py-2 text-sm font-semibold text-plutz-tan hover:bg-plutz-tan/30 border border-plutz-tan/20 transition",children:n("distribution.distribute_equally")})]})]}),t.jsx("div",{className:"space-y-4",children:l.map((e,s)=>{const d=e.recipient_type==="user"?i.find(m=>m.id===e.recipient_user_id):null,a=e.recipient_type==="mutual_fund"?n("distribution.mutual_fund"):d?.name||"Unknown";return t.jsxs("div",{className:"rounded-xl border border-plutz-tan/10 bg-plutz-dark p-4",children:[t.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[t.jsxs("div",{children:[t.jsx(z,{value:n("distribution.recipient")}),t.jsxs("div",{className:"mt-1 flex items-center",children:[t.jsx("span",{className:"font-medium text-plutz-cream",children:a}),e.recipient_type==="mutual_fund"&&t.jsx("span",{className:"ml-2 rounded-full bg-plutz-tan/20 px-2 py-0.5 text-xs text-plutz-tan",children:n("distribution.band_fund")})]})]}),t.jsx(R,{label:n("distribution.amount"),value:e.amount,onChange:m=>h(s,"amount",m),error:x[`distributions.${s}.amount`]})]}),t.jsxs("div",{className:"mt-4",children:[t.jsx(z,{htmlFor:`note-${s}`,value:n("distribution.note_optional")}),t.jsx("input",{id:`note-${s}`,type:"text",value:e.note,onChange:m=>h(s,"note",m.target.value),className:"mt-1 block w-full rounded-lg border-plutz-tan/20 bg-plutz-dark text-plutz-cream shadow-sm focus:border-plutz-tan focus:ring-plutz-tan sm:text-sm",placeholder:n("distribution.note_placeholder")})]})]},s)})}),t.jsxs("div",{className:"mt-6 rounded-xl bg-stone-900/50 border border-plutz-tan/10 p-4",children:[t.jsxs("div",{className:"flex items-center justify-between text-sm",children:[t.jsx("span",{className:"text-stone-400",children:n("distribution.total_distributed")}),t.jsxs("span",{className:"font-semibold text-plutz-cream",children:[o().toFixed(2)," EUR"]})]}),t.jsxs("div",{className:`mt-2 flex items-center justify-between text-sm ${j?"text-red-400":"text-stone-400"}`,children:[t.jsx("span",{children:n("distribution.remaining")}),t.jsxs("span",{className:"font-semibold",children:[v.toFixed(2)," EUR"]})]}),j&&t.jsx("p",{className:"mt-2 text-sm text-red-400",children:n("distribution.over_distributed")})]}),x.distributions&&t.jsx(C,{message:x.distributions,className:"mt-2"})]}),t.jsx("div",{className:"flex items-center justify-end",children:t.jsx(U,{disabled:r||j,children:n(r?"distribution.saving":"distribution.save")})})]})}function O({income:i,bandMembers:c,totalDistributed:b,remaining:N}){const{t:r}=w(),{data:x,setData:n,post:g,processing:l,errors:p}=S({distributions:[]}),u=o=>new Date(o).toLocaleDateString("sl-SI",{year:"numeric",month:"long",day:"numeric"}),f=o=>{y.post(route("incomes.distribute",i.id),{distributions:o})},h=()=>{confirm(r("incomes.confirm_delete"))&&y.delete(route("incomes.destroy",i.id))};return t.jsxs(I,{className:"bg-plutz-dark",children:[t.jsx(E,{title:`Income - ${i.contact_person}`}),t.jsxs("div",{className:"max-w-[1200px] mx-auto w-full p-6",children:[t.jsx("div",{className:"mb-6 overflow-hidden rounded-lg bg-plutz-surface shadow-sm",children:t.jsxs("div",{className:"p-6",children:[t.jsxs("div",{className:"flex items-start justify-between",children:[t.jsxs("div",{children:[t.jsx("h3",{className:"text-2xl font-bold text-plutz-cream",children:i.contact_person}),t.jsxs("p",{className:"mt-1 text-lg font-semibold text-green-400",children:[parseFloat(i.amount.toString()).toFixed(2)," ",i.currency]}),i.inquiry&&t.jsxs("p",{className:"mt-1 text-sm text-stone-400",children:[r("incomes.from")," ",i.inquiry.location_name]})]}),t.jsx("div",{className:"flex gap-2",children:i.invoice_issued&&t.jsx("span",{className:"inline-flex rounded-full bg-plutz-tan/20 px-3 py-1 text-xs font-semibold text-plutz-tan",children:r("incomes.invoice_issued")})})]}),t.jsx("div",{className:"mt-6",children:t.jsx("button",{onClick:h,className:"rounded-md bg-red-600 px-4 py-2 text-sm font-semibold text-white shadow-sm hover:bg-red-500/100",children:r("common.delete")})})]})}),t.jsxs("div",{className:"mb-6 overflow-hidden rounded-lg bg-plutz-surface shadow-sm",children:[t.jsx("div",{className:"border-b border-plutz-tan/10 px-6 py-4",children:t.jsx("h4",{className:"text-lg font-medium text-plutz-cream",children:r("incomes.income_details")})}),t.jsxs("div",{className:"p-6",children:[t.jsxs("dl",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[t.jsxs("div",{children:[t.jsx("dt",{className:"text-sm font-medium text-stone-500",children:r("incomes.date")}),t.jsx("dd",{className:"mt-1 text-sm text-plutz-cream",children:u(i.income_date)})]}),t.jsxs("div",{children:[t.jsx("dt",{className:"text-sm font-medium text-stone-500",children:r("incomes.performance_type")}),t.jsx("dd",{className:"mt-1 text-sm text-plutz-cream",children:i.performance_type.name})]}),t.jsxs("div",{children:[t.jsx("dt",{className:"text-sm font-medium text-stone-500",children:r("incomes.created_by")}),t.jsx("dd",{className:"mt-1 text-sm text-plutz-cream",children:i.creator.name})]})]}),i.notes&&t.jsxs("div",{className:"mt-4",children:[t.jsx("dt",{className:"text-sm font-medium text-stone-500",children:r("common.notes")}),t.jsx("dd",{className:"mt-1 whitespace-pre-wrap text-sm text-plutz-cream",children:i.notes})]})]})]}),t.jsxs("div",{className:"overflow-hidden rounded-lg bg-plutz-surface shadow-sm",children:[t.jsx("div",{className:"border-b border-plutz-tan/10 px-6 py-4",children:t.jsx("h4",{className:"text-lg font-medium text-plutz-cream",children:r("incomes.distribution")})}),t.jsx("div",{className:"p-6",children:t.jsx($,{bandMembers:c,totalAmount:parseFloat(i.amount.toString()),existingDistributions:i.distributions,onSubmit:f,processing:l,errors:p})})]})]})]})}export{O as default};
