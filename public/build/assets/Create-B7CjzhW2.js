import{r as p,u as w,j as e,H as z,L as x}from"./app-BdDqc3cB.js";import{A as k}from"./AuthenticatedLayout-B7hEQ3i9.js";import{u as A}from"./useTranslation-WO1u7QRH.js";import"./transition-D2mPo7cI.js";function D({auth:y,templates:d,activeTemplate:o}){const{t:s}=A(),[f,i]=p.useState(o?.id||null),m=p.useRef(o?.markdown||""),{data:a,setData:n,post:_,processing:h,errors:r}=w({client_name:"",client_email:"",client_company:"",client_address:"",performance_date:"",total_price:"",deposit_amount:"",currency:"EUR",markdown_snapshot:o?.markdown||"",contract_template_id:o?.id||null}),[u,b]=p.useState(!1),j=t=>{const c=t?parseInt(t):null,l=d.find(g=>g.id===c);if(!l){i(null);return}a.markdown_snapshot===""||a.markdown_snapshot===m.current?(n({...a,markdown_snapshot:l.markdown,contract_template_id:l.id}),m.current=l.markdown,i(c)):confirm("You have made changes to the contract content. Do you want to replace it with the selected template?")&&(n({...a,markdown_snapshot:l.markdown,contract_template_id:l.id}),m.current=l.markdown,i(c))},N=()=>{let t=a.markdown_snapshot||"";return t=t.replace(/\[NAROČNIK\]/g,a.client_name||"[NAROČNIK]"),t=t.replace(/\[EMAIL\]/g,a.client_email||"[EMAIL]"),t=t.replace(/\[PODJETJE\]/g,a.client_company||"[PODJETJE]"),t=t.replace(/\[NASLOV\]/g,a.client_address||"[NASLOV]"),t=t.replace(/\[DATUM_NASTOPA\]/g,a.performance_date||"[DATUM_NASTOPA]"),t=t.replace(/\[SKUPNI_ZNESEK\]/g,a.total_price?`${a.total_price} ${a.currency}`:"[SKUPNI_ZNESEK]"),t=t.replace(/\[AVANS\]/g,a.deposit_amount?`${a.deposit_amount} ${a.currency}`:"[AVANS]"),t},v=t=>{t.preventDefault(),_(route("contracts.store"))};return e.jsxs(k,{className:"bg-plutz-dark",children:[e.jsx(z,{title:s("contracts.create_contract")}),e.jsx("div",{className:"max-w-[1200px] mx-auto w-full p-6 pb-0",children:e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h2",{className:"text-2xl font-serif text-plutz-cream",children:s("contracts.create_contract")}),e.jsx(x,{href:route("contracts.index"),className:"text-plutz-tan hover:text-plutz-tan-light text-sm font-medium",children:s("contracts.back")})]})}),e.jsx("div",{className:"max-w-[1200px] mx-auto w-full p-6",children:e.jsx("div",{className:"bg-plutz-surface overflow-hidden shadow-sm sm:rounded-lg",children:e.jsxs("form",{onSubmit:v,className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-plutz-cream mb-4",children:s("contracts.client_information")}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-stone-400 mb-2",children:s("contracts.client_name_field")}),e.jsx("input",{type:"text",value:a.client_name,onChange:t=>n("client_name",t.target.value),className:"w-full rounded-md border-plutz-tan/20 shadow-sm focus:border-plutz-tan focus:ring-plutz-tan",required:!0}),r.client_name&&e.jsx("div",{className:"text-red-400 text-sm mt-1",children:r.client_name})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-stone-400 mb-2",children:s("contracts.client_email_field")}),e.jsx("input",{type:"email",value:a.client_email,onChange:t=>n("client_email",t.target.value),className:"w-full rounded-md border-plutz-tan/20 shadow-sm focus:border-plutz-tan focus:ring-plutz-tan",required:!0}),r.client_email&&e.jsx("div",{className:"text-red-400 text-sm mt-1",children:r.client_email})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-stone-400 mb-2",children:s("contracts.company_optional")}),e.jsx("input",{type:"text",value:a.client_company,onChange:t=>n("client_company",t.target.value),className:"w-full rounded-md border-plutz-tan/20 shadow-sm focus:border-plutz-tan focus:ring-plutz-tan"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-stone-400 mb-2",children:s("contracts.performance_date_field")}),e.jsx("input",{type:"date",value:a.performance_date,onChange:t=>n("performance_date",t.target.value),className:"w-full rounded-md border-plutz-tan/20 shadow-sm focus:border-plutz-tan focus:ring-plutz-tan",required:!0}),r.performance_date&&e.jsx("div",{className:"text-red-400 text-sm mt-1",children:r.performance_date})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"block text-sm font-medium text-stone-400 mb-2",children:s("contracts.address_optional")}),e.jsx("textarea",{value:a.client_address,onChange:t=>n("client_address",t.target.value),rows:3,className:"w-full rounded-md border-plutz-tan/20 shadow-sm focus:border-plutz-tan focus:ring-plutz-tan"})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-plutz-cream mb-4",children:s("contracts.financial_details")}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-stone-400 mb-2",children:s("contracts.total_price_field")}),e.jsx("input",{type:"number",step:"0.01",value:a.total_price,onChange:t=>n("total_price",t.target.value),className:"w-full rounded-md border-plutz-tan/20 shadow-sm focus:border-plutz-tan focus:ring-plutz-tan",required:!0}),r.total_price&&e.jsx("div",{className:"text-red-400 text-sm mt-1",children:r.total_price})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-stone-400 mb-2",children:s("contracts.deposit_amount")}),e.jsx("input",{type:"number",step:"0.01",value:a.deposit_amount,onChange:t=>n("deposit_amount",t.target.value),className:"w-full rounded-md border-plutz-tan/20 shadow-sm focus:border-plutz-tan focus:ring-plutz-tan"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-stone-400 mb-2",children:s("contracts.currency")}),e.jsxs("select",{value:a.currency,onChange:t=>n("currency",t.target.value),className:"w-full rounded-md border-plutz-tan/20 shadow-sm focus:border-plutz-tan focus:ring-plutz-tan",children:[e.jsx("option",{value:"EUR",children:"EUR"}),e.jsx("option",{value:"USD",children:"USD"}),e.jsx("option",{value:"GBP",children:"GBP"})]})]})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-medium text-plutz-cream",children:s("contracts.contract_content")}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx(x,{href:route("contract-templates.index"),className:"text-sm text-stone-400 hover:text-plutz-cream",children:s("contracts.manage_templates")}),e.jsx("button",{type:"button",onClick:()=>b(!u),className:"text-sm text-plutz-tan hover:text-plutz-tan",children:s(u?"contracts.hide_preview":"contracts.show_preview")})]})]}),d.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-stone-400 mb-2",children:s("contracts.template")}),e.jsxs("select",{value:f||"",onChange:t=>j(t.target.value),className:"w-full rounded-md border-plutz-tan/20 shadow-sm focus:border-plutz-tan focus:ring-plutz-tan",children:[e.jsx("option",{value:"",children:s("contracts.select_template")}),d.map(t=>e.jsxs("option",{value:t.id,children:[t.name," ",t.is_active?"(Active)":""]},t.id))]})]}),e.jsxs("div",{className:"text-sm text-stone-400 mb-2",children:[s("contracts.placeholders_hint")," [NAROČNIK], [EMAIL], [PODJETJE], [NASLOV], [DATUM_NASTOPA], [SKUPNI_ZNESEK], [AVANS], [PLUTZ_ADDRESS]"]}),e.jsx("textarea",{value:a.markdown_snapshot,onChange:t=>n("markdown_snapshot",t.target.value),rows:15,className:"w-full rounded-md border-plutz-tan/20 shadow-sm focus:border-plutz-tan focus:ring-plutz-tan font-mono text-sm",required:!0}),r.markdown_snapshot&&e.jsx("div",{className:"text-red-400 text-sm mt-1",children:r.markdown_snapshot}),u&&e.jsxs("div",{className:"mt-4 p-4 border border-plutz-tan/20 rounded-md bg-stone-900/50",children:[e.jsx("h4",{className:"font-medium mb-2",children:s("contracts.preview")}),e.jsx("div",{className:"prose max-w-none",children:N().split(`
`).map((t,c)=>e.jsx("p",{children:t},c))})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx(x,{href:route("contracts.index"),className:"px-4 py-2 bg-plutz-tan/20 text-stone-400 rounded-md hover:bg-plutz-tan/30",children:s("common.cancel")}),e.jsx("button",{type:"submit",disabled:h,className:"px-4 py-2 bg-plutz-tan text-plutz-dark rounded-md hover:bg-plutz-tan/90 disabled:opacity-50",children:s(h?"contracts.creating":"contracts.create_contract")})]})]})})})]})}export{D as default};
