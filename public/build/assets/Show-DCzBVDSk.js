import{r as y,j as e,u as F,H as S,a as z}from"./app-QF8Djih4.js";import{A as k}from"./AuthenticatedLayout-B1FF3WAE.js";import{I as _}from"./InputLabel-BpEykd4n.js";import{I}from"./TextInput-DlNGpiaq.js";import{M as E}from"./MoneyInput-DJDuKprS.js";import{P as R}from"./PrimaryButton-sx2jL4Aq.js";import{u as T}from"./useTranslation-MJhb3H-H.js";import"./transition-FqaZM9d4.js";function C({bandMembers:n,totalAmount:d,existingDistributions:b=[],onSubmit:N,processing:i=!1,errors:u={}}){const g=()=>{if(b.length>0)return b.map(s=>({recipient_type:s.recipient_type,recipient_user_id:s.recipient_user_id,amount:s.amount.toString(),note:s.note||""}));const t=n.map(s=>({recipient_type:"user",recipient_user_id:s.id,amount:"",note:""}));return t.push({recipient_type:"mutual_fund",recipient_user_id:void 0,amount:"",note:""}),t},[l,x]=y.useState(g()),[o,j]=y.useState(!1),p=(t,s,r)=>{const a=[...l];a[t]={...a[t],[s]:r},x(a)},h=()=>l.reduce((t,s)=>t+(parseFloat(s.amount)||0),0),c=()=>d-h(),w=()=>{const t=[...l],s=o?t:t.filter(a=>a.recipient_type!=="mutual_fund"),r=(d/s.length).toFixed(2);t.forEach(a=>{o||a.recipient_type!=="mutual_fund"?a.amount=r:a.amount="0"}),x(t)},D=t=>{t.preventDefault();const s=l.filter(r=>parseFloat(r.amount)>0);N(s)},v=c(),f=v<0;return e.jsxs("form",{onSubmit:D,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-plutz-cream",children:"Income Distribution"}),e.jsxs("p",{className:"mt-1 text-sm text-stone-400",children:["Total to distribute: ",e.jsxs("span",{className:"font-semibold text-plutz-cream",children:[d.toFixed(2)," EUR"]})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:o,onChange:t=>j(t.target.checked),className:"h-4 w-4 rounded border-plutz-tan/20 bg-plutz-dark text-plutz-tan focus:ring-plutz-tan"}),e.jsx("span",{className:"text-stone-400",children:"Include Mutual Fund"})]}),e.jsx("button",{type:"button",onClick:w,className:"rounded-xl bg-plutz-tan/20 px-3 py-2 text-sm font-semibold text-plutz-tan hover:bg-plutz-tan/30 border border-plutz-tan/20 transition",children:"Distribute Equally"})]})]}),e.jsx("div",{className:"space-y-4",children:l.map((t,s)=>{const r=t.recipient_type==="user"?n.find(m=>m.id===t.recipient_user_id):null,a=t.recipient_type==="mutual_fund"?"Mutual Fund":r?.name||"Unknown";return e.jsxs("div",{className:"rounded-xl border border-plutz-tan/10 bg-plutz-dark p-4",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx(_,{value:"Recipient"}),e.jsxs("div",{className:"mt-1 flex items-center",children:[e.jsx("span",{className:"font-medium text-plutz-cream",children:a}),t.recipient_type==="mutual_fund"&&e.jsx("span",{className:"ml-2 rounded-full bg-plutz-tan/20 px-2 py-0.5 text-xs text-plutz-tan",children:"Band Fund"})]})]}),e.jsx(E,{label:"Amount",value:t.amount,onChange:m=>p(s,"amount",m),error:u[`distributions.${s}.amount`]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx(_,{htmlFor:`note-${s}`,value:"Note (optional)"}),e.jsx("input",{id:`note-${s}`,type:"text",value:t.note,onChange:m=>p(s,"note",m.target.value),className:"mt-1 block w-full rounded-lg border-plutz-tan/20 bg-plutz-dark text-plutz-cream shadow-sm focus:border-plutz-tan focus:ring-plutz-tan sm:text-sm",placeholder:"Optional note..."})]})]},s)})}),e.jsxs("div",{className:"mt-6 rounded-xl bg-stone-900/50 border border-plutz-tan/10 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-stone-400",children:"Total Distributed:"}),e.jsxs("span",{className:"font-semibold text-plutz-cream",children:[h().toFixed(2)," EUR"]})]}),e.jsxs("div",{className:`mt-2 flex items-center justify-between text-sm ${f?"text-red-400":"text-stone-400"}`,children:[e.jsx("span",{children:"Remaining:"}),e.jsxs("span",{className:"font-semibold",children:[v.toFixed(2)," EUR"]})]}),f&&e.jsx("p",{className:"mt-2 text-sm text-red-400",children:"Total distributed exceeds income amount!"})]}),u.distributions&&e.jsx(I,{message:u.distributions,className:"mt-2"})]}),e.jsx("div",{className:"flex items-center justify-end",children:e.jsx(R,{disabled:i||f,children:i?"Saving...":"Save Distribution"})})]})}function O({income:n,bandMembers:d,totalDistributed:b,remaining:N}){const{t:i}=T(),{data:u,setData:g,post:l,processing:x,errors:o}=F({distributions:[]}),j=c=>new Date(c).toLocaleDateString("sl-SI",{year:"numeric",month:"long",day:"numeric"}),p=c=>{z.post(route("incomes.distribute",n.id),{distributions:c})},h=()=>{confirm(i("incomes.confirm_delete"))&&z.delete(route("incomes.destroy",n.id))};return e.jsxs(k,{className:"bg-plutz-dark",children:[e.jsx(S,{title:`Income - ${n.contact_person}`}),e.jsxs("div",{className:"max-w-[1200px] mx-auto w-full p-6",children:[e.jsx("div",{className:"mb-6 overflow-hidden rounded-lg bg-plutz-surface shadow-sm",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold text-plutz-cream",children:n.contact_person}),e.jsxs("p",{className:"mt-1 text-lg font-semibold text-green-400",children:[parseFloat(n.amount.toString()).toFixed(2)," ",n.currency]}),n.inquiry&&e.jsxs("p",{className:"mt-1 text-sm text-stone-400",children:[i("incomes.from")," ",n.inquiry.location_name]})]}),e.jsx("div",{className:"flex gap-2",children:n.invoice_issued&&e.jsx("span",{className:"inline-flex rounded-full bg-plutz-tan/20 px-3 py-1 text-xs font-semibold text-plutz-tan",children:i("incomes.invoice_issued")})})]}),e.jsx("div",{className:"mt-6",children:e.jsx("button",{onClick:h,className:"rounded-md bg-red-600 px-4 py-2 text-sm font-semibold text-white shadow-sm hover:bg-red-500/100",children:i("common.delete")})})]})}),e.jsxs("div",{className:"mb-6 overflow-hidden rounded-lg bg-plutz-surface shadow-sm",children:[e.jsx("div",{className:"border-b border-plutz-tan/10 px-6 py-4",children:e.jsx("h4",{className:"text-lg font-medium text-plutz-cream",children:i("incomes.income_details")})}),e.jsxs("div",{className:"p-6",children:[e.jsxs("dl",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("dt",{className:"text-sm font-medium text-stone-500",children:i("incomes.date")}),e.jsx("dd",{className:"mt-1 text-sm text-plutz-cream",children:j(n.income_date)})]}),e.jsxs("div",{children:[e.jsx("dt",{className:"text-sm font-medium text-stone-500",children:i("incomes.performance_type")}),e.jsx("dd",{className:"mt-1 text-sm text-plutz-cream",children:n.performance_type.name})]}),e.jsxs("div",{children:[e.jsx("dt",{className:"text-sm font-medium text-stone-500",children:i("incomes.created_by")}),e.jsx("dd",{className:"mt-1 text-sm text-plutz-cream",children:n.creator.name})]})]}),n.notes&&e.jsxs("div",{className:"mt-4",children:[e.jsx("dt",{className:"text-sm font-medium text-stone-500",children:i("common.notes")}),e.jsx("dd",{className:"mt-1 whitespace-pre-wrap text-sm text-plutz-cream",children:n.notes})]})]})]}),e.jsxs("div",{className:"overflow-hidden rounded-lg bg-plutz-surface shadow-sm",children:[e.jsx("div",{className:"border-b border-plutz-tan/10 px-6 py-4",children:e.jsx("h4",{className:"text-lg font-medium text-plutz-cream",children:i("incomes.distribution")})}),e.jsx("div",{className:"p-6",children:e.jsx(C,{bandMembers:d,totalAmount:parseFloat(n.amount.toString()),existingDistributions:n.distributions,onSubmit:p,processing:x,errors:o})})]})]})]})}export{O as default};
